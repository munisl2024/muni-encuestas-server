import"./chunk-GN3ET3J5.js";import{a as N}from"./chunk-PTIWJ3ZS.js";import{b as H,d as A,g as G,q as F}from"./chunk-FMNQVWW6.js";import{a as P}from"./chunk-VUVQYZVZ.js";import"./chunk-5QPYTDH3.js";import{a as D}from"./chunk-JTVQZKZI.js";import{g as j}from"./chunk-LRQMHJK3.js";import{m as B,p as V}from"./chunk-PL2ZQQHO.js";import{Ab as h,Kb as a,Lb as _,Mb as b,Nb as E,Pb as M,Qb as I,Rb as z,Tb as T,Ua as n,Va as g,ga as C,ib as k,kb as c,nb as v,qa as y,qb as e,ra as w,rb as t,sa as d,sb as o,ta as p,vb as S,zb as u}from"./chunk-DRQLPHCS.js";function R(l,f){if(l&1&&(e(0,"div",61)(1,"div",62),d(),e(2,"svg",63),o(3,"circle",64)(4,"path",65),t(),p(),e(5,"p",66),a(6,"Cargando mapa..."),t(),e(7,"p",67),a(8),t()()()),l&2){let r=h();n(8),E("Intento ",r.intentosInicializacion," de ",r.maxIntentos,"")}}function O(l,f){if(l&1){let r=S();e(0,"div",68)(1,"div",69),d(),e(2,"svg",70),o(3,"path",71),t(),p(),e(4,"p",72),a(5,"Error al cargar el mapa"),t(),e(6,"p",73),a(7,"No se pudo inicializar el mapa correctamente"),t(),e(8,"button",74),u("click",function(){y(r);let i=h();return w(i.recargarMapa())}),d(),e(9,"svg",75),o(10,"path",76),t(),a(11," Reintentar "),t()()()}}function q(l,f){l&1&&(e(0,"div",77),d(),e(1,"svg",75),o(2,"path",78),t(),a(3," Creando Pol\xEDgono "),t())}function W(l,f){if(l&1&&(e(0,"div",79)(1,"span",80),a(2),t(),a(3),t()),l&2){let r=h();n(2),_(r.coordenadas.length),n(),b(" punto",r.coordenadas.length!==1?"s":""," ")}}function U(l,f){if(l&1){let r=S();e(0,"div",81)(1,"button",82),u("click",function(){y(r);let i=h();return w(i.recargarMapa())}),d(),e(2,"svg",83),o(3,"path",76),t()()()}}var ae=(()=>{class l{constructor(r,s,i,m){this.barriosService=r,this.alertService=s,this.authService=i,this.router=m,this.barrio={descripcion:""},this.mapa=null,this.mapaInicializado=!1,this.mapaCargando=!0,this.mapaError=!1,this.poligono=null,this.coordenadas=[],this.guardando=!1,this.intentosInicializacion=0,this.maxIntentos=5}ngOnInit(){}ngAfterViewInit(){this.mapaCargando=!0,setTimeout(()=>{this.inicializarMapa()},300)}ngOnDestroy(){this.mapa&&this.mapa.remove()}inicializarMapa(){if(this.intentosInicializacion++,this.intentosInicializacion>this.maxIntentos){console.error("Se excedi\xF3 el n\xFAmero m\xE1ximo de intentos de inicializaci\xF3n"),this.mapaCargando=!1,this.mapaError=!0;return}try{if(typeof L>"u"){console.warn(`Intento ${this.intentosInicializacion}: Leaflet no est\xE1 cargado`),setTimeout(()=>this.inicializarMapa(),400);return}let r=document.getElementById("mapa-crear-barrio");if(!r){console.warn(`Intento ${this.intentosInicializacion}: Elemento del mapa no encontrado`),setTimeout(()=>this.inicializarMapa(),400);return}let s=r.getBoundingClientRect();if(s.height===0||s.width===0){console.warn(`Intento ${this.intentosInicializacion}: El contenedor no tiene dimensiones`),setTimeout(()=>this.inicializarMapa(),400);return}if(this.mapa){try{this.mapa.off(),this.mapa.remove()}catch(m){console.warn("Error al remover mapa anterior:",m)}this.mapa=null}this.mapa=L.map("mapa-crear-barrio",{center:[-33.3020084,-66.3364262],zoom:18,zoomControl:!0,attributionControl:!1,preferCanvas:!0});let i=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors",maxZoom:19,subdomains:["a","b","c"]});i.on("load",()=>{console.log("Tiles del mapa cargados correctamente"),this.mapaCargando=!1,this.mapaError=!1}),i.on("tileerror",m=>{console.error("Error al cargar tiles:",m)}),i.addTo(this.mapa),this.mapa.on("click",m=>{this.agregarPunto(m.latlng)}),this.mapaInicializado=!0,this.mapaCargando=!1,this.mapaError=!1,console.log("Mapa inicializado correctamente"),setTimeout(()=>{this.mapa&&this.mapa.invalidateSize()},100),setTimeout(()=>{this.mapa&&this.mapa.invalidateSize()},400),setTimeout(()=>{this.mapa&&this.mapa.invalidateSize()},800)}catch(r){console.error("Error al inicializar el mapa:",r),this.mapaError=!0,this.mapaCargando=!1,this.intentosInicializacion<this.maxIntentos&&!this.mapaInicializado&&setTimeout(()=>this.inicializarMapa(),500)}}recargarMapa(){if(console.log("Recargando mapa manualmente..."),this.mapaInicializado=!1,this.mapaCargando=!0,this.mapaError=!1,this.intentosInicializacion=0,this.mapa){try{this.mapa.off(),this.mapa.remove()}catch(r){console.warn("Error al remover mapa:",r)}this.mapa=null}setTimeout(()=>{this.inicializarMapa()},200)}agregarPunto(r){this.coordenadas.push({lat:r.lat,lng:r.lng}),L.marker([r.lat,r.lng],{icon:L.divIcon({className:"punto-poligono",html:'<div class="w-3 h-3 bg-purple-500 rounded-full border-2 border-white shadow-lg"></div>',iconSize:[12,12],iconAnchor:[6,6]})}).addTo(this.mapa),this.coordenadas.length>=3&&this.crearPoligono()}crearPoligono(){this.poligono&&this.mapa.removeLayer(this.poligono);let r=this.coordenadas.map(s=>[s.lat,s.lng]);this.poligono=L.polygon(r,{color:"#8B5CF6",weight:3,opacity:.8,fillColor:"#8B5CF6",fillOpacity:.2,dashArray:"5, 5"}).addTo(this.mapa)}limpiarMapa(){this.coordenadas=[],this.mapa.eachLayer(r=>{r.options&&r.options.icon&&r.options.icon.options.className==="punto-poligono"&&this.mapa.removeLayer(r)}),this.poligono&&(this.mapa.removeLayer(this.poligono),this.poligono=null)}guardarBarrio(){if(!this.barrio.descripcion.trim()){this.alertService.errorApi("La descripci\xF3n del barrio es obligatoria.");return}if(this.coordenadas.length<3){this.alertService.errorApi("El pol\xEDgono debe tener al menos 3 puntos.");return}this.alertService.question({msg:"\xBFEst\xE1 seguro de crear el nuevo barrio?",buttonText:"Crear"}).then(({isConfirmed:r})=>{if(r){this.guardando=!0,this.alertService.loading();let s={descripcion:this.barrio.descripcion.trim(),coordenadas:this.coordenadas,creatorUserId:this.authService.usuario.userId};this.barriosService.nuevoBarrio(s).subscribe({next:()=>{this.alertService.close(),this.guardando=!1,this.alertService.success("Barrio creado correctamente"),this.router.navigate(["/dashboard/barrios"])},error:i=>{this.alertService.close(),this.guardando=!1,this.alertService.errorApi("Error al crear el barrio"),console.error("Error:",i)}})}})}cancelar(){this.coordenadas.length>0||this.barrio.descripcion.trim()?this.alertService.question({msg:"\xBFEst\xE1 seguro de cancelar? Se perder\xE1n los datos ingresados.",buttonText:"Cancelar"}).then(({isConfirmed:r})=>{r&&this.router.navigate(["/dashboard/barrios"])}):this.router.navigate(["/dashboard/barrios"])}volver(){this.cancelar()}static{this.\u0275fac=function(s){return new(s||l)(g(N),g(P),g(D),g(j))}}static{this.\u0275cmp=C({type:l,selectors:[["app-crear-barrio"]],standalone:!0,features:[T],decls:109,vars:20,consts:[[1,"min-h-screen","bg-gradient-to-br","from-purple-50","via-white","to-indigo-50"],[1,"container","mx-auto","px-4","sm:px-6","py-6","sm:py-8"],[1,"bg-white","border","border-gray-300","rounded-xl","shadow-sm","p-4","sm:p-6","mb-6"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","space-y-4","sm:space-y-0"],[1,"flex","items-center","space-x-3","sm:space-x-4"],[1,"flex","items-center","space-x-2","px-4","py-2.5","bg-gray-800","text-white","text-sm","font-medium","rounded-lg","hover:from-gray-700","hover:to-gray-800","transition-all","duration-200","shadow-sm",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-2xl","sm:text-3xl","font-bold","text-gray-800"],[1,"text-gray-600","text-sm","mt-1"],[1,"flex","items-center","space-x-2","text-sm"],[1,"flex","items-center","space-x-1"],[1,"w-3","h-3","rounded-full","transition-colors","duration-200"],[1,"text-gray-600"],[1,"w-4","h-0.5","bg-gray-300"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"space-y-6"],[1,"bg-white","border","border-gray-300","rounded-xl","shadow-sm","overflow-hidden"],[1,"bg-gray-800","px-6","py-4"],[1,"text-lg","font-semibold","text-white","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"p-6","space-y-6"],["for","descripcion",1,"block","text-sm","font-semibold","text-gray-700","mb-3"],["id","descripcion","type","text","placeholder","Ej: Barrio Centro, Barrio Norte...",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-purple-500","transition-all","duration-200","text-gray-700","placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"bg-gradient-to-r","from-purple-50","to-indigo-50","rounded-xl","p-4","border","border-purple-100"],[1,"font-semibold","text-gray-700","mb-3","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","text-purple-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","text-sm","font-medium","text-gray-700"],[1,"w-3","h-3","bg-purple-500","rounded-full","mr-2","animate-pulse"],[1,"px-3","py-1","rounded-full","text-xs","font-medium"],[1,"bg-white","rounded-xl","border","border-gray-300","shadow-sm","overflow-hidden"],[1,"bg-gray-700","px-6","py-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"p-6"],[1,"space-y-4"],[1,"flex","items-start","space-x-3","group"],[1,"flex-shrink-0","w-7","h-7","bg-purple-100","text-purple-600","rounded-full","flex","items-center","justify-center","text-sm","font-bold","group-hover:bg-purple-200","transition-colors"],[1,"text-gray-700","text-sm"],[1,"relative","h-[400px]","sm:h-[500px]"],["id","mapa-crear-barrio",1,"w-full","h-full","rounded-xl","border-2","border-gray-200","bg-gray-100","shadow-inner"],["class","absolute inset-0 bg-gray-100/95 backdrop-blur-sm rounded-xl flex items-center justify-center z-50",4,"ngIf"],["class","absolute inset-0 bg-red-50/95 backdrop-blur-sm rounded-xl flex items-center justify-center z-50",4,"ngIf"],["class","absolute top-4 left-4 bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-4 py-2 rounded-lg text-sm shadow-lg",4,"ngIf"],["class","absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg text-sm text-gray-700 shadow-lg border border-gray-200",4,"ngIf"],["class","absolute bottom-4 right-4",4,"ngIf"],[1,"flex","justify-center"],[1,"px-6","py-3","bg-gradient-to-r","from-red-500","to-red-600","text-white","rounded-lg","hover:from-red-600","hover:to-red-700","disabled:from-gray-400","disabled:to-gray-500","disabled:cursor-not-allowed","text-sm","font-medium","shadow-lg","transition-all","duration-200",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"mt-8","bg-white","rounded-xl","shadow-sm","border","border-purple-100","p-6"],[1,"flex","flex-col","sm:flex-row","justify-center","items-center","space-y-3","sm:space-y-0","sm:space-x-4"],[1,"w-full","sm:w-auto","px-8","py-3","bg-gradient-to-r","from-gray-500","to-gray-600","text-white","rounded-lg","hover:from-gray-600","hover:to-gray-700","disabled:from-gray-400","disabled:to-gray-500","disabled:cursor-not-allowed","text-sm","font-medium","shadow-lg","transition-all","duration-200",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"w-full","sm:w-auto","px-8","py-3","bg-gradient-to-r","from-green-600","to-green-700","text-white","rounded-lg","hover:from-green-700","hover:to-green-800","disabled:from-gray-400","disabled:to-gray-500","disabled:cursor-not-allowed","text-sm","font-medium","shadow-lg","transition-all","duration-200",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"mt-4","text-center"],[1,"text-sm","text-gray-500"],[1,"absolute","inset-0","bg-gray-100/95","backdrop-blur-sm","rounded-xl","flex","items-center","justify-center","z-50"],[1,"text-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-12","w-12","text-purple-600","mx-auto","mb-3"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-gray-700","font-medium"],[1,"text-gray-500","text-sm","mt-1"],[1,"absolute","inset-0","bg-red-50/95","backdrop-blur-sm","rounded-xl","flex","items-center","justify-center","z-50"],[1,"text-center","p-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-12","w-12","text-red-500","mx-auto","mb-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"text-red-700","font-medium","mb-2"],[1,"text-red-600","text-sm","mb-4"],[1,"px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"absolute","top-4","left-4","bg-gradient-to-r","from-purple-500","to-indigo-600","text-white","px-4","py-2","rounded-lg","text-sm","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"absolute","top-4","right-4","bg-white/90","backdrop-blur-sm","px-4","py-2","rounded-lg","text-sm","text-gray-700","shadow-lg","border","border-gray-200"],[1,"font-semibold"],[1,"absolute","bottom-4","right-4"],["title","Recargar mapa",1,"bg-white/90","backdrop-blur-sm","p-2.5","rounded-lg","text-gray-700","hover:bg-white","hover:text-purple-600","shadow-lg","border","border-gray-200","transition-all","duration-200","hover:scale-110",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"]],template:function(s,i){s&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),u("click",function(){return i.volver()}),d(),e(6,"svg",6),o(7,"path",7),t()(),p(),e(8,"div")(9,"h1",8),a(10,"Crear Nuevo Barrio"),t(),e(11,"p",9),a(12,"Define las coordenadas y descripci\xF3n del barrio"),t()()(),e(13,"div",10)(14,"div",11),o(15,"div",12),e(16,"span",13),a(17,"Descripci\xF3n"),t()(),o(18,"div",14),e(19,"div",11),o(20,"div",12),e(21,"span",13),a(22,"Pol\xEDgono"),t()()()()(),e(23,"div",15)(24,"div",16)(25,"div",17)(26,"div",18)(27,"h3",19),d(),e(28,"svg",20),o(29,"path",21),t(),a(30," Informaci\xF3n del Barrio "),t()(),p(),e(31,"div",22)(32,"div")(33,"label",23),a(34," Descripci\xF3n del Barrio * "),t(),e(35,"input",24),z("ngModelChange",function(x){return I(i.barrio.descripcion,x)||(i.barrio.descripcion=x),x}),t()(),e(36,"div",25)(37,"h4",26),d(),e(38,"svg",27),o(39,"path",28),t(),a(40," Estado del Pol\xEDgono "),t(),p(),e(41,"div",29)(42,"div",30)(43,"span",31),o(44,"span",32),a(45),t()(),e(46,"span",33),a(47),t()()()()(),e(48,"div",34)(49,"div",35)(50,"h3",19),d(),e(51,"svg",20),o(52,"path",36),t(),a(53," Instrucciones "),t()(),p(),e(54,"div",37)(55,"div",38)(56,"div",39)(57,"div",40),a(58," 1 "),t(),e(59,"span",41),a(60,"Haz clic en el mapa para agregar puntos al pol\xEDgono"),t()(),e(61,"div",39)(62,"div",40),a(63," 2 "),t(),e(64,"span",41),a(65,"Se requieren m\xEDnimo 3 puntos para formar un pol\xEDgono v\xE1lido"),t()(),e(66,"div",39)(67,"div",40),a(68," 3 "),t(),e(69,"span",41),a(70,"El pol\xEDgono se dibujar\xE1 autom\xE1ticamente al tener 3 o m\xE1s puntos"),t()(),e(71,"div",39)(72,"div",40),a(73," 4 "),t(),e(74,"span",41),a(75,'Usa el bot\xF3n "Limpiar Mapa" para reiniciar si es necesario'),t()()()()()(),e(76,"div",16)(77,"div",17)(78,"div",18)(79,"h3",19),d(),e(80,"svg",20),o(81,"path",28),t(),a(82," Mapa para Crear Pol\xEDgono "),t()(),p(),e(83,"div",37)(84,"div",42),o(85,"div",43),k(86,R,9,2,"div",44)(87,O,12,0,"div",45)(88,q,4,0,"div",46)(89,W,4,2,"div",47)(90,U,4,0,"div",48),t()()(),e(91,"div",49)(92,"button",50),u("click",function(){return i.limpiarMapa()}),d(),e(93,"svg",51),o(94,"path",52),t(),a(95," Limpiar Mapa "),t()()()(),p(),e(96,"div",53)(97,"div",54)(98,"button",55),u("click",function(){return i.cancelar()}),d(),e(99,"svg",51),o(100,"path",56),t(),a(101," Cancelar "),t(),p(),e(102,"button",57),u("click",function(){return i.guardarBarrio()}),d(),e(103,"svg",51),o(104,"path",58),t(),a(105),t()(),p(),e(106,"div",59)(107,"p",60),a(108," Aseg\xFArate de completar la descripci\xF3n y agregar al menos 3 puntos al pol\xEDgono antes de crear el barrio. "),t()()()()()),s&2&&(n(15),v(i.barrio.descripcion.trim()?"bg-purple-500":"bg-gray-300"),n(5),v(i.coordenadas.length>=3?"bg-purple-500":"bg-gray-300"),n(15),M("ngModel",i.barrio.descripcion),c("disabled",i.guardando),n(10),E(" ",i.coordenadas.length," punto",i.coordenadas.length!==1?"s":""," "),n(),v(i.coordenadas.length>=3?"text-green-600 bg-green-100":"text-orange-600 bg-orange-100"),n(),b(" ",i.coordenadas.length>=3?"\u2713 V\xE1lido":"M\xEDnimo 3 puntos"," "),n(39),c("ngIf",i.mapaCargando),n(),c("ngIf",i.mapaError&&!i.mapaCargando),n(),c("ngIf",i.mapaInicializado&&!i.mapaCargando&&!i.mapaError),n(),c("ngIf",i.mapaInicializado&&!i.mapaCargando),n(),c("ngIf",i.mapaInicializado&&!i.mapaCargando&&!i.mapaError),n(2),c("disabled",i.coordenadas.length===0||i.guardando),n(6),c("disabled",i.guardando),n(4),c("disabled",!i.barrio.descripcion.trim()||i.coordenadas.length<3||i.guardando),n(3),b(" ",i.guardando?"Creando...":"Crear Barrio"," "))},dependencies:[V,B,F,H,A,G],encapsulation:2})}}return l})();export{ae as default};
