import{a as $}from"./chunk-RYDBVMX7.js";import{a as O}from"./chunk-ZDESPTUY.js";import{a as N}from"./chunk-SOEPROMY.js";import{a as R}from"./chunk-7ASKJ65C.js";import"./chunk-JN7XREYN.js";import{a as H}from"./chunk-YESQC6II.js";import{e as P,g as G,k as F}from"./chunk-LIJZX7MQ.js";import{m as j,n as z,p as A}from"./chunk-UHNCRVEK.js";import{$ as D,Bb as s,Cb as w,Db as y,Eb as L,Jb as V,Ob as B,Qb as T,Ua as n,Va as _,cb as l,d as U,e as M,ea as x,fa as f,fb as S,ga as d,ha as b,hb as g,kb as t,lb as i,mb as c,pb as C,ub as v,vb as h}from"./chunk-GYUG5PKY.js";var u=U($());function q(o,m){o&1&&(d(),c(0,"path",18))}function K(o,m){o&1&&(d(),c(0,"path",19))}function Z(o,m){o&1&&(d(),c(0,"path",20))}function J(o,m){o&1&&(d(),c(0,"path",18))}function Q(o,m){if(o&1){let e=C();t(0,"div",12)(1,"button",13),v("click",function(){x(e);let a=h();return f(a.cambiarEstado())}),d(),t(2,"svg",14),g(3,q,1,0,"path",15)(4,K,1,0,"path",16),i(),s(5),i(),b(),t(6,"button",13),v("click",function(){x(e);let a=h();return f(a.toggleModoEdicion())}),d(),t(7,"svg",14),g(8,Z,1,0,"path",17)(9,J,1,0,"path",15),i(),s(10),i()()}if(o&2){let e=h();n(1),S(e.barrio.activo?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"),n(2),l("ngIf",e.barrio.activo),n(1),l("ngIf",!e.barrio.activo),n(1),y(" ",e.barrio.activo?"Baja de barrio":"Alta de barrio"," "),n(1),S(e.modoEdicion?"bg-orange-600 hover:bg-orange-700":"bg-purple-600 hover:bg-purple-700"),n(2),l("ngIf",!e.modoEdicion),n(1),l("ngIf",e.modoEdicion),n(1),y(" ",e.modoEdicion?"Cancelar Edici\xF3n":"Editar Pol\xEDgono"," ")}}function W(o,m){o&1&&(t(0,"div",21),c(1,"div",22),i())}function X(o,m){o&1&&(d(),t(0,"svg",4),c(1,"path",19),i())}function Y(o,m){o&1&&(d(),t(0,"svg",4),c(1,"path",18),i())}function ee(o,m){o&1&&(t(0,"div",39)(1,"div",40),d(),t(2,"svg",41),c(3,"path",42),i(),b(),t(4,"p",43),s(5,"No hay pol\xEDgono para mostrar"),i(),t(6,"p",44),s(7,"Importa un archivo KML para visualizar el barrio"),i()()())}function te(o,m){o&1&&(t(0,"div",45),s(1," Mapa cargado "),i())}function ie(o,m){o&1&&(t(0,"div",46),d(),t(1,"svg",47),c(2,"path",20),i(),s(3," Modo Edici\xF3n "),i())}function oe(o,m){if(o&1&&(t(0,"div",23)(1,"div",24)(2,"app-tarjeta-lista",25)(3,"div",26)(4,"div",27)(5,"span",28),s(6,"Descripci\xF3n:"),i(),t(7,"span",29),s(8),i()(),t(9,"div",27)(10,"span",28),s(11,"Estado:"),i(),t(12,"span",30),g(13,X,2,0,"svg",31)(14,Y,2,0,"svg",31),s(15),i()(),t(16,"div",27)(17,"span",28),s(18,"Fecha de creaci\xF3n:"),i(),t(19,"span",32),s(20),B(21,"date"),i()(),t(22,"div",27)(23,"span",28),s(24,"\xDAltima actualizaci\xF3n:"),i(),t(25,"span",32),s(26),B(27,"date"),i()(),t(28,"div",27)(29,"span",28),s(30,"Creado por:"),i(),t(31,"span",32),s(32),i()()()()(),t(33,"div",24)(34,"div",33)(35,"div",34)(36,"div",35),g(37,ee,8,0,"div",36),i(),g(38,te,2,0,"div",37)(39,ie,4,0,"div",38),i()()()()),o&2){let e=h();n(8),w(e.barrio.descripcion),n(4),S(e.barrio.activo?"text-green-600 font-semibold":"text-red-600 font-semibold"),n(1),l("ngIf",e.barrio.activo),n(1),l("ngIf",!e.barrio.activo),n(1),y(" ",e.barrio.activo?"Activo":"Inactivo"," "),n(5),w(T(21,13,e.barrio.createdAt,"dd/MM/yyyy HH:mm")),n(6),w(T(27,16,e.barrio.updatedAt,"dd/MM/yyyy HH:mm")),n(6),L("",e.barrio.creatorUser==null?null:e.barrio.creatorUser.nombre," ",e.barrio.creatorUser==null?null:e.barrio.creatorUser.apellido,""),n(5),l("ngIf",!e.barrio.CoordenadasToBarrio||e.barrio.CoordenadasToBarrio.length===0),n(1),l("ngIf",e.mapaInicializado&&e.barrio.CoordenadasToBarrio&&e.barrio.CoordenadasToBarrio.length>0),n(1),l("ngIf",e.modoEdicion)}}function re(o,m){if(o&1){let e=C();t(0,"div",48)(1,"button",49),v("click",function(){x(e);let a=h();return f(a.guardarCoordenadas())}),d(),t(2,"svg",50),c(3,"path",19),i(),s(4),i(),b(),t(5,"button",51),v("click",function(){x(e);let a=h();return f(a.cancelarEdicion())}),d(),t(6,"svg",50),c(7,"path",18),i(),s(8," Cancelar Edici\xF3n "),i()()}if(o&2){let e=h();n(1),l("disabled",e.coordenadasEditando.length<3),n(3),y(" Guardar Pol\xEDgono (",e.coordenadasEditando.length," puntos) ")}}function ae(o,m){if(o&1){let e=C();t(0,"div",52),d(),t(1,"svg",53),c(2,"path",54),i(),b(),t(3,"h3",55),s(4,"Barrio no encontrado"),i(),t(5,"p",56),s(6,"El barrio que buscas no existe o ha sido eliminado."),i(),t(7,"button",57),v("click",function(){x(e);let a=h();return f(a.volver())}),s(8," Volver a la lista "),i()()}}var ue=(()=>{class o{constructor(e,r,a,p,E){this.authService=e,this.barriosService=r,this.alertService=a,this.activatedRoute=p,this.router=E,this.permiso_escritura=["BARRIOS_ALL"],this.barrio=null,this.cargando=!0,this.mapa=null,this.mapaInicializado=!1,this.poligono=null,this.modoEdicion=!1,this.coordenadasEditando=[]}ngOnInit(){this.alertService.loading(),this.activatedRoute.params.subscribe(e=>{e.id&&this.cargarBarrio(e.id)})}ngAfterViewInit(){}ngOnDestroy(){this.mapa&&this.mapa.remove()}cargarBarrio(e){return M(this,null,function*(){try{let r=yield this.barriosService.getBarrioConCoordenadas(e).toPromise();this.barrio=r.barrio,this.cargando=!1,this.alertService.close(),setTimeout(()=>{this.inicializarMapa()},100)}catch(r){this.alertService.close(),this.alertService.errorApi("Error al cargar el barrio"),console.error("Error:",r)}})}inicializarMapa(){try{if(typeof u.default>"u"){console.error("Leaflet no est\xE1 cargado");return}let e=document.getElementById("mapa-detalle-barrio");if(!e){console.error("Elemento del mapa no encontrado");return}this.mapa&&(this.mapa.remove(),this.mapa=null,this.mapaInicializado=!1),e.innerHTML="";let r=-33.3020084,a=-66.3364262;if(this.barrio.CoordenadasToBarrio&&this.barrio.CoordenadasToBarrio.length>0){let p=this.barrio.CoordenadasToBarrio,E=0,k=0;p.forEach(I=>{E+=I.lat,k+=I.lng}),r=E/p.length,a=k/p.length}this.mapa=u.default.map("mapa-detalle-barrio",{center:[r,a],zoom:14,zoomControl:!0,attributionControl:!1}),u.default.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors",maxZoom:19,subdomains:["a","b","c"]}).addTo(this.mapa),this.barrio.CoordenadasToBarrio&&this.barrio.CoordenadasToBarrio.length>0&&this.crearPoligono(),this.mapa.on("click",p=>{this.modoEdicion&&this.agregarPuntoNuevoPoligono(p.latlng)}),this.mapaInicializado=!0,setTimeout(()=>{this.mapa&&this.mapa.invalidateSize()},100)}catch(e){console.error("Error al inicializar el mapa:",e)}}crearPoligono(){try{if(!this.mapa||!this.barrio.CoordenadasToBarrio)return;let e=this.barrio.CoordenadasToBarrio.map(r=>[r.lat,r.lng]);this.poligono=u.default.polygon(e,{color:"#3B82F6",weight:3,opacity:.8,fillColor:"#3B82F6",fillOpacity:.2}).addTo(this.mapa),this.poligono.bindPopup(`
        <div class="popup-barrio">
          <h3 class="font-bold text-lg mb-2">${this.barrio.descripcion}</h3>
          <p class="text-sm text-gray-600">Barrio</p>
          <p class="text-sm text-gray-600">Coordenadas: ${e.length}</p>
        </div>
      `),this.mapa.fitBounds(this.poligono.getBounds())}catch(e){console.error("Error al crear el pol\xEDgono:",e)}}volver(){this.router.navigate(["/dashboard/barrios"])}cambiarEstado(){let e=!this.barrio.activo,r=e?"activar":"desactivar";this.alertService.question({msg:`\xBFEst\xE1 seguro de ${r} el barrio?`,buttonText:"Aceptar"}).then(({isConfirmed:a})=>{a&&(this.alertService.loading(),this.barriosService.actualizarBarrio(this.barrio.id.toString(),{activo:e}).subscribe({next:p=>{this.alertService.close(),this.barrio.activo=e,this.alertService.success(`Barrio ${r}do correctamente`)},error:p=>{this.alertService.close(),this.alertService.errorApi("Error al cambiar el estado del barrio"),console.error("Error:",p)}}))})}editarBarrio(){this.barriosService.abrirAbm("editar",this.barrio)}toggleModoEdicion(){this.modoEdicion=!this.modoEdicion,this.modoEdicion?(this.coordenadasEditando=[],this.poligono&&(this.mapa.removeLayer(this.poligono),this.poligono=null),this.alertService.info("Modo edici\xF3n activado. Haz clic en el mapa para crear un nuevo pol\xEDgono (m\xEDnimo 3 puntos).")):(this.coordenadasEditando=[],this.limpiarMarcadoresTemporales(),this.barrio.CoordenadasToBarrio&&this.barrio.CoordenadasToBarrio.length>0&&this.crearPoligono(),this.alertService.info("Modo edici\xF3n desactivado."))}agregarPuntoNuevoPoligono(e){this.coordenadasEditando.push({lat:e.lat,lng:e.lng}),u.default.marker([e.lat,e.lng],{icon:u.default.divIcon({className:"punto-poligono",html:'<div class="w-3 h-3 bg-orange-500 rounded-full border-2 border-white shadow-lg"></div>',iconSize:[12,12],iconAnchor:[6,6]})}).addTo(this.mapa),this.coordenadasEditando.length>=3&&this.crearPoligonoTemporal()}crearPoligonoTemporal(){this.poligono&&this.mapa.removeLayer(this.poligono);let e=this.coordenadasEditando.map(r=>[r.lat,r.lng]);this.poligono=u.default.polygon(e,{color:"#F59E0B",weight:3,opacity:.8,fillColor:"#F59E0B",fillOpacity:.2,dashArray:"5, 5"}).addTo(this.mapa)}guardarCoordenadas(){this.alertService.question({msg:"\xBFEst\xE1 seguro de guardar las nuevas coordenadas del barrio?",buttonText:"Guardar"}).then(({isConfirmed:e})=>{e&&(this.alertService.loading(),this.barriosService.actualizarCoordenadas(this.barrio.id.toString(),{coordenadas:this.coordenadasEditando}).subscribe({next:r=>{this.alertService.close(),this.barrio.CoordenadasToBarrio=this.coordenadasEditando,this.modoEdicion=!1,this.coordenadasEditando=[],this.alertService.success("Coordenadas actualizadas correctamente"),this.limpiarMarcadoresTemporales(),this.poligono&&(this.mapa.removeLayer(this.poligono),this.crearPoligono())},error:r=>{this.alertService.close(),this.alertService.errorApi("Error al actualizar las coordenadas"),console.error("Error:",r)}}))})}cancelarEdicion(){this.modoEdicion=!1,this.coordenadasEditando=[],this.limpiarMarcadoresTemporales(),this.poligono&&(this.mapa.removeLayer(this.poligono),this.poligono=null),this.barrio.CoordenadasToBarrio&&this.barrio.CoordenadasToBarrio.length>0&&this.crearPoligono(),this.alertService.info("Edici\xF3n cancelada")}limpiarMarcadoresTemporales(){this.mapa.eachLayer(e=>{e.options&&e.options.icon&&e.options.icon.options.className==="punto-poligono"&&this.mapa.removeLayer(e)})}static{this.\u0275fac=function(r){return new(r||o)(_(H),_(N),_(R),_(P),_(G))}}static{this.\u0275cmp=D({type:o,selectors:[["app-detalles-barrio"]],standalone:!0,features:[V],decls:13,vars:5,consts:[[1,"container","mx-auto","px-2","sm:px-4","py-4","sm:py-6","min-h-screen","bg-gray-50"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","mb-4","sm:mb-6","space-y-3","sm:space-y-0"],[1,"flex","items-center","space-x-2","sm:space-x-4"],[1,"flex","items-center","space-x-1","sm:space-x-2","px-3","sm:px-4","py-2","bg-gray-700","text-white","text-sm","sm:text-base","rounded-lg","hover:bg-gray-800","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","sm:w-5","sm:h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-3xl","font-bold","text-gray-800"],["class","flex items-center space-x-2 sm:space-x-3",4,"ngIf"],["class","flex justify-center items-center py-8 sm:py-12",4,"ngIf"],["class","grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",4,"ngIf"],["class","mt-4 flex justify-center space-x-3",4,"ngIf"],["class","text-center py-8 sm:py-12",4,"ngIf"],[1,"flex","items-center","space-x-2","sm:space-x-3"],[1,"px-3","sm:px-4","py-2","text-sm","sm:text-base","text-white","rounded-lg","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","sm:w-5","sm:h-5","inline","mr-1","sm:mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"],[1,"flex","justify-center","items-center","py-8","sm:py-12"],[1,"animate-spin","rounded-full","h-8","w-8","sm:h-12","sm:w-12","border-b-2","border-blue-600"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4","sm:gap-6"],[1,"space-y-4","sm:space-y-6"],["titulo","Informaci\xF3n del Barrio"],[1,"space-y-3","sm:space-y-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","p-3","sm:p-4","bg-gray-50","rounded-lg"],[1,"font-medium","text-gray-700","mb-1","sm:mb-0"],[1,"text-gray-900","font-semibold"],[1,"flex","items-center","space-x-1","sm:space-x-2"],["class","w-4 h-4 sm:w-5 sm:h-5","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],[1,"text-gray-900","text-sm","sm:text-base"],["titulo","Visualizaci\xF3n del Pol\xEDgono",1,"md:mt-10"],[1,"relative","h-[350px]"],["id","mapa-detalle-barrio",1,"w-full","h-64","sm:h-96","rounded-lg","border-2","border-gray-200","bg-gray-100"],["class","flex items-center justify-center h-full text-gray-500 p-4",4,"ngIf"],["class","absolute top-2 right-2 bg-white px-2 py-1 rounded text-xs text-gray-600 shadow-sm",4,"ngIf"],["class","absolute top-2 left-2 bg-orange-500 text-white px-3 py-1 rounded text-sm shadow-sm",4,"ngIf"],[1,"flex","items-center","justify-center","h-full","text-gray-500","p-4"],[1,"text-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","sm:w-16","sm:h-16","mx-auto","mb-3","sm:mb-4","text-gray-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"font-medium","text-sm","sm:text-base"],[1,"text-xs","sm:text-sm"],[1,"absolute","top-2","right-2","bg-white","px-2","py-1","rounded","text-xs","text-gray-600","shadow-sm"],[1,"absolute","top-2","left-2","bg-orange-500","text-white","px-3","py-1","rounded","text-sm","shadow-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],[1,"mt-4","flex","justify-center","space-x-3"],[1,"px-6","py-3","bg-green-600","text-white","rounded-lg","hover:bg-green-700","disabled:bg-gray-400","disabled:cursor-not-allowed","text-sm","font-medium","shadow-lg",3,"disabled","click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],[1,"px-6","py-3","bg-red-600","text-white","rounded-lg","hover:bg-red-700","text-sm","font-medium","shadow-lg",3,"click"],[1,"text-center","py-8","sm:py-12"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","sm:w-16","sm:h-16","mx-auto","mb-3","sm:mb-4","text-red-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-base","sm:text-lg","font-medium","text-gray-900","mb-2"],[1,"text-sm","sm:text-base","text-gray-500"],[1,"mt-4","px-4","py-2","text-sm","sm:text-base","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700",3,"click"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),v("click",function(){return a.volver()}),d(),t(4,"svg",4),c(5,"path",5),i()(),b(),t(6,"h1",6),s(7,"Detalles del Barrio"),i()(),g(8,Q,11,10,"div",7),i(),g(9,W,2,0,"div",8)(10,oe,40,19,"div",9)(11,re,9,2,"div",10)(12,ae,9,0,"div",11),i()),r&2&&(n(8),l("ngIf",!a.cargando&&a.barrio&&a.authService.isAdmin),n(1),l("ngIf",a.cargando),n(1),l("ngIf",!a.cargando&&a.barrio),n(1),l("ngIf",a.modoEdicion&&!a.cargando&&a.barrio),n(1),l("ngIf",!a.cargando&&!a.barrio))},dependencies:[A,j,z,F,O],encapsulation:2})}}return o})();export{ue as default};
