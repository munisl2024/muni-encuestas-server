import{a as V}from"./chunk-RYDBVMX7.js";import{a as D}from"./chunk-SOEPROMY.js";import{c as w,f as C,j as M,k as T,l as F,p as k}from"./chunk-LNBIFSMN.js";import{a as _}from"./chunk-7ASKJ65C.js";import{l as y,p as B}from"./chunk-UHNCRVEK.js";import{$ as x,Bb as o,Cb as v,Db as u,Jb as E,Ua as n,Va as f,cb as g,d as L,ga as p,ha as m,hb as S,kb as i,lb as e,mb as d,ub as b}from"./chunk-GYUG5PKY.js";var c=L(V());function z(s,j){if(s&1&&(i(0,"option",34),o(1),e()),s&2){let t=j.$implicit;g("value",t),n(1),u(" ",t," ")}}var P=(()=>{class s{constructor(t,a){this.barriosService=t,this.alertService=a,this.barrios=[],this.barriosFiltrados=[],this.cargando=!0,this.filtroDescripcion="",this.descripcionesUnicas=[]}ngOnInit(){this.cargarBarrios()}ngAfterViewInit(){this.inicializarMapa()}ngOnDestroy(){this.map&&this.map.remove()}inicializarMapa(){this.map=c.default.map("mapaBarrios").setView([-34.6037,-58.3816],10),c.default.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),this.barriosLayer=c.default.layerGroup().addTo(this.map)}cargarBarrios(){this.alertService.loading("Cargando barrios..."),this.barriosService.getAllConCoordenadas().subscribe({next:t=>{this.barrios=t.barrios,this.barriosFiltrados=[...this.barrios],this.obtenerDescripcionesUnicas(),this.cargando=!1,this.alertService.close(),this.dibujarBarrios(),this.ajustarVistaMapa()},error:t=>{this.cargando=!1,this.alertService.errorApi(t.error?.message||"Error al cargar los barrios")}})}obtenerDescripcionesUnicas(){this.descripcionesUnicas=[...new Set(this.barrios.map(t=>t.descripcion))].sort()}filtrarPorDescripcion(){this.filtroDescripcion===""?this.barriosFiltrados=[...this.barrios]:this.barriosFiltrados=this.barrios.filter(t=>t.descripcion===this.filtroDescripcion),this.dibujarBarrios(),this.ajustarVistaMapa()}dibujarBarrios(){this.barriosLayer.clearLayers(),this.barriosFiltrados.forEach(t=>{if(t.CoordenadasToBarrio&&t.CoordenadasToBarrio.length>0){let a=t.CoordenadasToBarrio.map(h=>[h.lat,h.lng]),r=c.default.polygon(a,{color:"#3388ff",weight:2,opacity:.8,fillColor:"#3388ff",fillOpacity:.2}),l=`
          <div class="p-3 min-w-[200px]">
            <h3 class="font-bold text-lg text-gray-800 mb-2">${t.descripcion}</h3>
            <div class="space-y-1">
              <p class="text-sm text-gray-600">
                <span class="font-medium">Estado:</span> 
                <span class="${t.activo?"text-green-600":"text-red-600"} font-medium">
                  ${t.activo?"Activo":"Inactivo"}
                </span>
              </p>
            </div>
          </div>
        `;r.bindPopup(l,{maxWidth:250,className:"custom-popup",closeButton:!0,autoClose:!1,closeOnClick:!1}),r.on("click",()=>{r.openPopup()}),r.on("mouseover",()=>{r.setStyle({weight:3,opacity:1,fillOpacity:.4})}),r.on("mouseout",()=>{r.setStyle({weight:2,opacity:.8,fillOpacity:.2})}),r.addTo(this.barriosLayer)}})}ajustarVistaMapa(){if(this.barriosFiltrados.length>0){let t=this.calcularBounds();t.isValid()&&this.map.fitBounds(t,{padding:[20,20]})}}calcularBounds(){let t=c.default.latLngBounds([]);return this.barriosFiltrados.forEach(a=>{a.CoordenadasToBarrio&&a.CoordenadasToBarrio.length>0&&a.CoordenadasToBarrio.forEach(r=>{t.extend([r.lat,r.lng])})}),t}obtenerEstadisticas(){let t=this.barrios.length,a=this.barriosFiltrados.length,r=this.barriosFiltrados.filter(l=>l.CoordenadasToBarrio&&l.CoordenadasToBarrio.length>0).length;return{total:t,filtrados:a,conCoordenadas:r}}mostrarTodosLosBarrios(){this.filtroDescripcion="",this.barriosFiltrados=[...this.barrios],this.dibujarBarrios(),this.ajustarVistaMapa()}limpiarSeleccion(){this.filtroDescripcion="",this.barriosFiltrados=[...this.barrios],this.dibujarBarrios(),this.ajustarVistaMapa()}static{this.\u0275fac=function(a){return new(a||s)(f(D),f(_))}}static{this.\u0275cmp=x({type:s,selectors:[["app-geolocalizacion-barrios"]],standalone:!0,features:[E],decls:78,vars:7,consts:[[1,"container","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"bg-white","rounded-lg","shadow","p-4","border-l-4","border-blue-500"],[1,"flex","items-center"],[1,"p-2","bg-blue-100","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"bg-white","rounded-lg","shadow","p-4","border-l-4","border-green-500"],[1,"p-2","bg-green-100","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"bg-white","rounded-lg","shadow","p-4","mb-6"],[1,"flex","flex-wrap","gap-4","items-center"],[1,"flex-1","min-w-[250px]"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition","duration-200",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"md:mt-5","text-sm","text-gray-600"],[1,"font-medium"],[1,"flex","flex-wrap","gap-3"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition","duration-200","flex","items-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 10h16M4 14h16M4 18h16"],[1,"bg-white","rounded-lg","h-[600px]","shadow","overflow-hidden"],["id","mapaBarrios",1,"w-full","h-[600px]"],[1,"mt-6","bg-white","rounded-lg","shadow","p-4"],[1,"text-lg","font-semibold","text-gray-800","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm","text-gray-600"],[3,"value"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),p(),i(5,"svg",5),d(6,"path",6),e()(),m(),i(7,"div",7)(8,"p",8),o(9,"Total Barrios"),e(),i(10,"p",9),o(11),e()()()(),i(12,"div",10)(13,"div",3)(14,"div",11),p(),i(15,"svg",12),d(16,"path",13),e()(),m(),i(17,"div",7)(18,"p",8),o(19,"Barrios Filtrados"),e(),i(20,"p",9),o(21),e()()()()(),i(22,"div",14)(23,"div",15)(24,"div",16)(25,"label",17),p(),i(26,"svg",18),d(27,"path",19),e(),o(28," Filtrar por Descripci\xF3n "),e(),m(),i(29,"select",20),b("ngModelChange",function(h){return r.filtroDescripcion=h})("change",function(){return r.filtrarPorDescripcion()}),i(30,"option",21),o(31,"Todos los barrios"),e(),S(32,z,2,2,"option",22),e()(),i(33,"div",23)(34,"span",24),o(35,"Total:"),e(),o(36),i(37,"span",24),o(38,"Filtrados:"),e(),o(39),e()()(),i(40,"div",14)(41,"div",25)(42,"button",26),b("click",function(){return r.mostrarTodosLosBarrios()}),p(),i(43,"svg",27),d(44,"path",28),e(),o(45," Mostrar Todos "),e()()(),m(),i(46,"div",29),d(47,"div",30),e(),i(48,"div",31)(49,"h3",32),o(50,"Informaci\xF3n del Mapa"),e(),i(51,"div",33)(52,"div")(53,"p")(54,"strong"),o(55,"\u2022"),e(),o(56," Haz clic en un pol\xEDgono para ver la informaci\xF3n del barrio"),e(),i(57,"p")(58,"strong"),o(59,"\u2022"),e(),o(60," Usa el filtro para mostrar solo barrios espec\xEDficos"),e(),i(61,"p")(62,"strong"),o(63,"\u2022"),e(),o(64," Zoom y pan para navegar por el mapa"),e()(),i(65,"div")(66,"p")(67,"strong"),o(68,"\u2022"),e(),o(69),e(),i(70,"p")(71,"strong"),o(72,"\u2022"),e(),o(73," Los popups muestran nombre, estado e informaci\xF3n del barrio"),e(),i(74,"p")(75,"strong"),o(76,"\u2022"),e(),o(77," Efectos visuales al pasar el mouse sobre los pol\xEDgonos"),e()()()()()),a&2&&(n(11),v(r.obtenerEstadisticas().total),n(10),v(r.obtenerEstadisticas().filtrados),n(8),g("ngModel",r.filtroDescripcion),n(3),g("ngForOf",r.descripcionesUnicas),n(4),u(" ",r.obtenerEstadisticas().total," | "),n(3),u(" ",r.obtenerEstadisticas().filtrados," "),n(30),u(" Barrios con coordenadas: ",r.obtenerEstadisticas().conCoordenadas,""))},dependencies:[B,y,k,T,F,M,w,C],encapsulation:2})}}return s})();export{P as default};
