import{a as G}from"./chunk-3IRNNYMM.js";import{a as _}from"./chunk-PTIWJ3ZS.js";import{c as k,f as F,j as T,k as D,l as z,p as L}from"./chunk-3IXDAJZQ.js";import{a as V}from"./chunk-VUVQYZVZ.js";import{l as C,p as M}from"./chunk-PL2ZQQHO.js";import{Kb as o,Lb as x,Mb as h,Pb as E,Qb as w,Rb as y,Tb as B,Ua as n,Va as g,d as A,ga as v,ib as S,kb as f,qb as i,rb as e,sa as p,sb as c,ta as u,zb as b}from"./chunk-DRQLPHCS.js";var s=A(G());function I(l,j){if(l&1&&(i(0,"option",39),o(1),e()),l&2){let t=j.$implicit;f("value",t),n(),h(" ",t," ")}}var O="assets/marker-icon-2x.png",U="assets/marker-icon.png",H="assets/marker-shadow.png",N=s.default.icon({iconRetinaUrl:O,iconUrl:U,shadowUrl:H,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});s.default.Marker.prototype.options.icon=N;var K=(()=>{class l{constructor(t,a){this.barriosService=t,this.alertService=a,this.barrios=[],this.barriosFiltrados=[],this.cargando=!0,this.filtroDescripcion="",this.descripcionesUnicas=[]}ngOnInit(){this.cargarBarrios()}ngAfterViewInit(){this.inicializarMapa()}ngOnDestroy(){this.map&&this.map.remove()}inicializarMapa(){this.map=s.default.map("mapaBarrios",{center:[-33.3020084,-66.3364262],zoom:13,zoomControl:!0,attributionControl:!1,scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0}),s.default.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors",maxZoom:19,subdomains:["a","b","c"]}).addTo(this.map),this.barriosLayer=s.default.layerGroup().addTo(this.map),setTimeout(()=>{this.map&&this.map.invalidateSize()},100)}cargarBarrios(){this.alertService.loading("Cargando barrios..."),this.barriosService.getAllConCoordenadas().subscribe({next:t=>{this.barrios=t.barrios,this.barriosFiltrados=[...this.barrios],this.obtenerDescripcionesUnicas(),this.cargando=!1,this.alertService.close(),this.dibujarBarrios(),this.ajustarVistaMapa()},error:t=>{this.cargando=!1,this.alertService.errorApi(t.error?.message||"Error al cargar los barrios")}})}obtenerDescripcionesUnicas(){this.descripcionesUnicas=[...new Set(this.barrios.map(t=>t.descripcion))].sort()}filtrarPorDescripcion(){this.filtroDescripcion===""?this.barriosFiltrados=[...this.barrios]:this.barriosFiltrados=this.barrios.filter(t=>t.descripcion===this.filtroDescripcion),this.dibujarBarrios(),this.ajustarVistaMapa()}dibujarBarrios(){this.barriosLayer.clearLayers(),this.barriosFiltrados.forEach(t=>{if(t.CoordenadasToBarrio&&t.CoordenadasToBarrio.length>0){let a=t.CoordenadasToBarrio.map(m=>[m.lat,m.lng]),r=s.default.polygon(a,{color:"#2563EB",weight:3,opacity:.9,fillColor:"#3B82F6",fillOpacity:.3,smoothFactor:1}),d=`
          <div class="popup-barrio-geo" style="min-width: 200px;">
            <h3 class="font-bold text-lg mb-2 text-blue-700">${t.descripcion}</h3>
            <div class="space-y-1">
              <p class="text-sm text-gray-600">
                <strong>Estado:</strong>
                <span class="${t.activo?"text-green-600":"text-red-600"} font-semibold">
                  ${t.activo?"Activo":"Inactivo"}
                </span>
              </p>
              <p class="text-sm text-gray-600">
                <strong>Puntos:</strong> ${t.CoordenadasToBarrio.length}
              </p>
              ${t.createdAt?`<p class="text-sm text-gray-500 mt-2"><strong>Creado:</strong> ${new Date(t.createdAt).toLocaleDateString()}</p>`:""}
            </div>
          </div>
        `;r.bindPopup(d,{maxWidth:300,className:"custom-popup-barrios",closeButton:!0,autoClose:!1,closeOnClick:!1}),r.on("click",()=>{r.openPopup()}),r.on("mouseover",()=>{r.setStyle({weight:5,opacity:1,fillOpacity:.5,color:"#1E40AF"})}),r.on("mouseout",()=>{r.setStyle({weight:3,opacity:.9,fillOpacity:.3,color:"#2563EB"})}),r.addTo(this.barriosLayer)}})}ajustarVistaMapa(){if(this.barriosFiltrados.length>0){let t=this.calcularBounds();t.isValid()&&this.map.fitBounds(t,{padding:[50,50],maxZoom:16})}}calcularBounds(){let t=s.default.latLngBounds([]);return this.barriosFiltrados.forEach(a=>{a.CoordenadasToBarrio&&a.CoordenadasToBarrio.length>0&&a.CoordenadasToBarrio.forEach(r=>{t.extend([r.lat,r.lng])})}),t}obtenerEstadisticas(){let t=this.barrios.length,a=this.barriosFiltrados.length,r=this.barriosFiltrados.filter(d=>d.CoordenadasToBarrio&&d.CoordenadasToBarrio.length>0).length;return{total:t,filtrados:a,conCoordenadas:r}}mostrarTodosLosBarrios(){this.filtroDescripcion="",this.barriosFiltrados=[...this.barrios],this.dibujarBarrios(),this.ajustarVistaMapa()}limpiarSeleccion(){this.filtroDescripcion="",this.barriosFiltrados=[...this.barrios],this.dibujarBarrios(),this.ajustarVistaMapa()}static{this.\u0275fac=function(a){return new(a||l)(g(_),g(V))}}static{this.\u0275cmp=v({type:l,selectors:[["app-geolocalizacion-barrios"]],standalone:!0,features:[B],decls:85,vars:7,consts:[[1,"container","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"bg-white","rounded-lg","shadow","p-4","border-l-4","border-blue-500"],[1,"flex","items-center"],[1,"p-2","bg-blue-100","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"bg-white","rounded-lg","shadow","p-4","border-l-4","border-green-500"],[1,"p-2","bg-green-100","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"bg-white","rounded-lg","shadow","p-4","mb-6"],[1,"flex","flex-wrap","gap-4","items-center"],[1,"flex-1","min-w-[250px]"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition","duration-200",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"md:mt-5","text-sm","text-gray-600"],[1,"font-medium"],[1,"flex","flex-wrap","gap-3"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition","duration-200","flex","items-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 10h16M4 14h16M4 18h16"],[1,"bg-white","rounded-lg","shadow","overflow-hidden","border-2","border-gray-200"],[1,"p-4","bg-gray-800"],[1,"text-xl","font-bold","text-white","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"],[1,"text-blue-100","text-sm","mt-1"],["id","mapaBarrios",1,"w-full","h-[500px]","sm:h-[600px]","lg:h-[700px]"],[1,"mt-6","bg-white","rounded-lg","shadow","p-4"],[1,"text-lg","font-semibold","text-gray-800","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm","text-gray-600"],[3,"value"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),p(),i(5,"svg",5),c(6,"path",6),e()(),u(),i(7,"div",7)(8,"p",8),o(9,"Total Barrios"),e(),i(10,"p",9),o(11),e()()()(),i(12,"div",10)(13,"div",3)(14,"div",11),p(),i(15,"svg",12),c(16,"path",13),e()(),u(),i(17,"div",7)(18,"p",8),o(19,"Barrios Filtrados"),e(),i(20,"p",9),o(21),e()()()()(),i(22,"div",14)(23,"div",15)(24,"div",16)(25,"label",17),p(),i(26,"svg",18),c(27,"path",19),e(),o(28," Filtrar por Descripci\xF3n "),e(),u(),i(29,"select",20),y("ngModelChange",function(m){return w(r.filtroDescripcion,m)||(r.filtroDescripcion=m),m}),b("change",function(){return r.filtrarPorDescripcion()}),i(30,"option",21),o(31,"Todos los barrios"),e(),S(32,I,2,2,"option",22),e()(),i(33,"div",23)(34,"span",24),o(35,"Total:"),e(),o(36),i(37,"span",24),o(38,"Filtrados:"),e(),o(39),e()()(),i(40,"div",14)(41,"div",25)(42,"button",26),b("click",function(){return r.mostrarTodosLosBarrios()}),p(),i(43,"svg",27),c(44,"path",28),e(),o(45," Mostrar Todos "),e()()(),u(),i(46,"div",29)(47,"div",30)(48,"h2",31),p(),i(49,"svg",32),c(50,"path",33),e(),o(51," Mapa de Barrios Geolocalizados "),e(),u(),i(52,"p",34),o(53," Visualizaci\xF3n de todos los barrios con sus delimitaciones geogr\xE1ficas "),e()(),c(54,"div",35),e(),i(55,"div",36)(56,"h3",37),o(57,"Informaci\xF3n del Mapa"),e(),i(58,"div",38)(59,"div")(60,"p")(61,"strong"),o(62,"\u2022"),e(),o(63," Haz clic en un pol\xEDgono para ver la informaci\xF3n del barrio"),e(),i(64,"p")(65,"strong"),o(66,"\u2022"),e(),o(67," Usa el filtro para mostrar solo barrios espec\xEDficos"),e(),i(68,"p")(69,"strong"),o(70,"\u2022"),e(),o(71," Zoom y pan para navegar por el mapa"),e()(),i(72,"div")(73,"p")(74,"strong"),o(75,"\u2022"),e(),o(76),e(),i(77,"p")(78,"strong"),o(79,"\u2022"),e(),o(80," Los popups muestran nombre, estado e informaci\xF3n del barrio"),e(),i(81,"p")(82,"strong"),o(83,"\u2022"),e(),o(84," Efectos visuales al pasar el mouse sobre los pol\xEDgonos"),e()()()()()),a&2&&(n(11),x(r.obtenerEstadisticas().total),n(10),x(r.obtenerEstadisticas().filtrados),n(8),E("ngModel",r.filtroDescripcion),n(3),f("ngForOf",r.descripcionesUnicas),n(4),h(" ",r.obtenerEstadisticas().total," | "),n(3),h(" ",r.obtenerEstadisticas().filtrados," "),n(37),h(" Barrios con coordenadas: ",r.obtenerEstadisticas().conCoordenadas,""))},dependencies:[M,C,L,D,z,T,k,F],encapsulation:2})}}return l})();export{K as default};
